<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="/css/main/style.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.4.2/css/bootstrap-slider.min.css" rel="stylesheet"/>

    <title>储物整理</title>
</head>

<body>

<!--<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">-->
    <!--<a class="navbar-brand" href="#">整理俺的家</a>-->
    <!--<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">-->
        <!--<span class="navbar-toggler-icon"></span>-->
    <!--</button>-->

    <!--<div class="collapse navbar-collapse" id="navbarsExampleDefault">-->
        <!--<ul class="navbar-nav mr-auto">-->
            <!--<li class="nav-item active">-->
                <!--<a class="nav-link" href="#">首页 <span class="sr-only"></span></a>-->
            <!--</li>-->
            <!--<li class="nav-item dropdown">-->
                <!--<a class="nav-link dropdown-toggle" id="house1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">俺的House1</a>-->
                <!--<div class="dropdown-menu" aria-labelledby="house1">-->
                    <!--<a class="dropdown-item" href="#">管理储物空间</a>-->
                    <!--<a class="dropdown-item" href="#">管理物品</a>-->
                    <!--<a class="dropdown-item" href="#">删除House</a>-->
                <!--</div>-->
            <!--</li>-->

            <!--<li class="nav-item dropdown">-->
                <!--<a class="nav-link dropdown-toggle" id="option" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">设置</a>-->
                <!--<div class="dropdown-menu" aria-labelledby="option">-->
                    <!--<a class="dropdown-item" href="#">添加House</a>-->
                <!--</div>-->
            <!--</li>-->
        <!--</ul>-->
        <!--<form class="form-inline my-2 my-lg-0">-->
            <!--<input class="form-control mr-sm-2" type="text" placeholder="输入找不到的物品名字" aria-label="Search">-->
            <!--<button class="btn btn-outline-default my-2 my-sm-0" type="submit">搜索</button>-->
        <!--</form>-->
    <!--</div>-->
<!--</nav>-->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">收纳趴</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">收纳趴</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">首页</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        俺的House1
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#">管理储物空间</a></li>
                        <li><a href="#">管理物品</a></li>
                        <li><a href="#">删除House</a></li>
                        <!--<li role="separator" class="divider"></li>-->
                        <!--<li class="dropdown-header">Nav header</li>-->
                        <!--<li><a href="#">Separated link</a></li>-->
                        <!--<li><a href="#">One more separated link</a></li>-->
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        设置
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#">添加House</a></li>
                    </ul>
                </li>
            </ul>
            <form class="navbar-form navbar-right">
                <div class="form-group">
                    <input type="text" placeholder="输入找不到的物品名字" class="form-control">
                </div>
                <button type="submit" class="btn btn-default">搜索</button>
            </form>
        </div><!--/.navbar-collapse -->
    </div>
</nav>
<div role="main" class="container" style="max-width:100% !important;">

    <div class="content row">
        <div class="col-lg-4 col-xs-12">
            <div>
                <label for="zoom">图片缩放</label><br/>
                <input id="zoom" type="text"
                       data-provide="slider"
                       data-slider-ticks="[1, 1.2, 1.4]"
                       data-slider-ticks-labels='["小", "中", "大"]'
                       data-slider-min="1"
                       data-slider-max="1.4"
                       data-slider-step="0.2"
                       data-slider-value="1"
                       data-slider-tooltip="hide" />
            </div>

            <div id="edit" style="display: none">
                <button type="button" class="btn btn-secondary">Check</button>
            </div>
        </div>
        <div class="col-lg-8 col-xs-12">
            <div id="planImage" style="
                width:672px;
                height:647px;">
            </div>
        </div>
    </div>

</div>


<script src="https://code.jquery.com/jquery-3.3.1.min.js"
		integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
		crossorigin="anonymous"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.4.2/bootstrap-slider.min.js"></script>

<script>
    var xStart = 0;
    var yStart = 0;
    var xEnd = 0;
    var yEnd = 0;

    var svgWidth = 672;
    var svgHeight = 647;
    var zoomNumber = 1;

    $(function() {

        $.ajax({
            url: 'https://mokulive.oss-cn-shanghai.aliyuncs.com/house.svg',
            type: "get",
            dataType: "text"
        }).done(function (svg) {
            $("#planImage").html(svg);
        });

        $("#planImage").mousedown(function(e){
            xStart=e.pageX-$(this).offset().left; //获取当前鼠标相对div的X坐标
            yStart=e.pageY-$(this).offset().top; //获取当前鼠标相对div的Y坐标
            if(xStart && yStart) {
                $("#selectionArea").remove();
                xEnd = xStart+1;
                yEnd = yStart+1;
                var path = '<g id="selectionArea"><path d="M'+xStart*10/zoomNumber+' '+yStart*10/zoomNumber +
                    ' L'+xEnd*10/zoomNumber+' '+yStart*10/zoomNumber +
                    ' L'+xEnd*10/zoomNumber+' '+yEnd*10/zoomNumber +
                    ' L'+xStart*10/zoomNumber+' '+yEnd*10/zoomNumber + ' Z" fill="rgba(253,161,103,0.6)"/></g>';
                $("#planImage").find("svg").append(path);
                $("#planImage").find("svg").html($("#planImage").find("svg").html());
            }
        });

        $("#planImage").mousemove(function(e){
            xEnd=e.pageX-$(this).offset().left; //获取当前鼠标相对div的X坐标
            yEnd=e.pageY-$(this).offset().top; //获取当前鼠标相对div的Y坐标
            if(xStart && yStart) {
                $("#selectionArea").html(
                    '<path d="M'+xStart*10/zoomNumber+' '+yStart*10/zoomNumber +
                    ' L'+xEnd*10/zoomNumber+' '+yStart*10/zoomNumber +
                    ' L'+xEnd*10/zoomNumber+' '+yEnd*10/zoomNumber +
                    ' L'+xStart*10/zoomNumber+' '+yEnd*10/zoomNumber + ' Z"' +
					' fill="rgba(253,161,103,0.6)"/>'
				);
                $("#planImage").find("svg").html($("#planImage").find("svg").html());
            }
        });

        $("#planImage").mouseup(function(e){
            console.log(xStart+','+yStart+','+xEnd+','+yEnd);
            xEnd=e.pageX-$(this).offset().left; //获取当前鼠标相对div的X坐标
            yEnd=e.pageY-$(this).offset().top; //获取当前鼠标相对div的Y坐标
            if(xStart && yStart){
                if(xStart === xEnd && yStart === yEnd){
                    $("#selectionArea").remove();
                }

	            
                xStart = 0;
                yStart = 0;
                xEnd = 0;
                yEnd = 0;
            }

            if($("#selectionArea").attr("id")){
                $("#edit").show();
            }else{
                $("#edit").hide();
            }
        });

        $("#zoom").change(function(){
            var val = $(this).val();
            zoomNumber = Number(val);
            $("#planImage").css("width",svgWidth*zoomNumber);
            $("#planImage").css("height",svgHeight*zoomNumber);
            if($("#selectionArea").attr("id")){
                $("#selectionArea").remove();
            }
            $("#edit").hide();
        });
    });
</script>
</body>
</html>
